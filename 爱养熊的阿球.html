<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宠物MBTI性格测试 - 可爱版</title>
    <link href="https://fonts.googleapis.com/小林/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/xiaolin/css/all.min.css">
    <style>
        :root {
            --primary: #FF6B8B;
            --secondary: #6A5ACD;
            --accent: #FFD166;
            --light: #FFEDF0;
            --dark: #4A4B8C;
            --success: #06D6A0;
            --info: #118AB2;
            --white: #FFFFFF;
            --light-gray: #F8F9FA;
            --shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #fff0f5, #e6e6fa);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
            border: 2px solid var(--light);
        }

        .page {
            display: none;
            padding: 30px;
        }

        .active {
            display: block;
        }

        header {
            text-align: center;
            padding: 40px 20px 30px;
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header-decor {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cpath d='M50,50 Q100,30 150,50 Q170,100 150,150 Q100,170 50,150 Q30,100 50,50 Z' fill='none' stroke='white' stroke-width='1'/%3E%3C/svg%3E");
            background-size: 120px;
        }

        .pet-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--accent);
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 300px;
            margin: 15px auto;
            padding: 16px 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .btn i {
            margin-right: 10px;
        }

        .btn-pet {
            background: var(--light);
            color: var(--secondary);
            border: 2px solid rgba(106, 90, 205, 0.2);
        }

        .btn-pet:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
            background: white;
            border-color: var(--secondary);
        }

        .btn-upload {
            background: var(--secondary);
            color: white;
        }

        .btn-upload:hover {
            background: #5649b5;
            transform: translateY(-3px);
        }

        .btn-next {
            background: var(--success);
            color: white;
        }

        .btn-next:hover {
            background: #05b88b;
            transform: translateY(-3px);
        }

        .btn-back {
            background: #e9ecef;
            color: #495057;
        }

        .btn-back:hover {
            background: #dee2e6;
            transform: translateY(-3px);
        }

        .btn-restart {
            background: var(--secondary);
            color: white;
        }

        .btn-save {
            background: var(--primary);
            color: white;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .btn-group .btn {
            max-width: 200px;
        }

        .pets-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .pet-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #555;
            background: rgba(255, 107, 139, 0.08);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px dashed rgba(255, 107, 139, 0.3);
        }

        .photo-frame {
            width: 100%;
            max-width: 500px;
            height: 350px;
            margin: 0 auto 30px;
            border: 3px dashed var(--primary);
            border-radius: 20px;
            background: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .photo-frame img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .photo-placeholder {
            color: #adb5bd;
            font-size: 1.2rem;
            text-align: center;
            padding: 20px;
        }

        .photo-placeholder i {
            font-size: 5rem;
            color: var(--primary);
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .question-box {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: var(--shadow);
            border: 2px solid var(--light);
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 30px;
            color: var(--dark);
            line-height: 1.5;
            font-weight: 500;
            display: flex;
            align-items: flex-start;
        }

        .question-text i {
            color: var(--primary);
            margin-right: 15px;
            font-size: 1.8rem;
            margin-top: 5px;
        }

        .options-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 18px 20px;
            border-radius: 12px;
            background: white;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }

        .option i {
            margin-right: 15px;
            font-size: 1.4rem;
            color: var(--secondary);
            min-width: 30px;
        }

        .option:hover {
            background: #f8f9fa;
            border-color: var(--secondary);
            transform: translateX(5px);
        }

        .option.selected {
            background: rgba(106, 90, 205, 0.08);
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.2);
        }

        .progress-container {
            margin: 25px 0;
            padding: 0 10px;
        }

        .progress-bar {
            height: 14px;
            background: #e9ecef;
            border-radius: 7px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* 结果页面样式 */
        .result-container {
            background: white;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin: 20px 0;
            border: 2px solid var(--light);
        }

        .result-header {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .result-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cpath d='M50,50 Q100,30 150,50 Q170,100 150,150 Q100,170 50,150 Q30,100 50,50 Z' fill='none' stroke='white' stroke-width='1'/%3E%3C/svg%3E");
            background-size: 120px;
        }

        .result-title {
            font-size: 2.2rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .result-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        .pet-photo-container {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 20px;
            border: 5px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 2;
        }

        .pet-photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .mbti-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent), #FFB347);
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            padding: 15px 40px;
            border-radius: 50px;
            margin: 15px 0;
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .mbti-name {
            font-size: 1.8rem;
            color: white;
            position: relative;
            z-index: 2;
            margin-bottom: 20px;
        }

        .result-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px dashed #e9ecef;
        }

        .section:last-child {
            border-bottom: none;
            margin-bottom: 10px;
            padding-bottom: 10px;
        }

        .section-title {
            font-size: 1.6rem;
            color: var(--secondary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            padding-left: 10px;
            border-left: 4px solid var(--primary);
        }

        .section-title i {
            margin-right: 12px;
            color: var(--primary);
            font-size: 1.8rem;
        }

        .traits-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .trait-card {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            transition: var(--transition);
        }

        .trait-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .trait-card i {
            font-size: 2rem;
            color: var(--primary);
            margin-right: 15px;
            min-width: 40px;
        }

        .trait-text {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .analysis-content {
            background: rgba(255, 214, 102, 0.08);
            border-radius: 15px;
            padding: 25px;
            line-height: 1.8;
            font-size: 1.1rem;
            margin: 20px 0;
            border-left: 4px solid var(--accent);
        }

        .suggestions-list {
            margin-top: 20px;
        }

        .suggestion {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--success);
        }

        .suggestion i {
            font-size: 1.5rem;
            color: var(--success);
            margin-right: 15px;
            min-width: 30px;
            margin-top: 3px;
        }

        footer {
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            padding: 25px 0 15px;
            margin-top: 20px;
        }

        .decoration {
            position: absolute;
            z-index: 1;
            opacity: 0.2;
            font-size: 120px;
            color: var(--primary);
        }

        .decoration-1 {
            top: 20px;
            right: 30px;
            transform: rotate(15deg);
        }

        .decoration-2 {
            bottom: 20px;
            left: 30px;
            transform: rotate(-10deg);
        }

        .report-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }

        .report-notification i {
            margin-right: 10px;
            font-size: 1.4rem;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 20px;
            }

            .page {
                padding: 20px;
            }

            h1 {
                font-size: 2.2rem;
            }

            h2 {
                font-size: 1.2rem;
            }

            .btn {
                padding: 14px;
                font-size: 1rem;
            }

            .btn-group {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .btn-group .btn {
                max-width: 100%;
            }

            .photo-frame {
                height: 280px;
            }

            .question-text {
                font-size: 1.2rem;
            }

            .mbti-badge {
                font-size: 2rem;
                padding: 12px 30px;
            }

            .pet-photo-container {
                width: 150px;
                height: 150px;
            }

            .pets-group {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 宠物选择页面 -->
        <div id="page-pet-selection" class="page active">
            <header>
                <div class="header-decor"></div>
                <div class="header-content">
                    <div class="pet-icon">
                        <i class="fas fa-paw"></i>
                    </div>
                    <h1>宠物性格测试</h1>
                    <h2>发现您宠物的真实性格类型</h2>
                </div>
            </header>

            <div class="pets-group">
                <button class="btn btn-pet" data-pet="金丝熊">
                    <i class="fas fa-paw"></i>金丝熊
                </button>
                <button class="btn btn-pet" data-pet="侏儒类">
                    <i class="fas fa-paw"></i>侏儒类
                </button>
                <button class="btn btn-pet" data-pet="喵喵">
                    <i class="fas fa-cat"></i>喵喵
                </button>
                <button class="btn btn-pet" data-pet="狗狗">
                    <i class="fas fa-dog"></i>狗狗
                </button>
                <button class="btn btn-pet" data-pet="龙猫">
                    <i class="fas fa-paw"></i>龙猫
                </button>
                <button class="btn btn-pet" data-pet="荷兰猪">
                    <i class="fas fa-paw"></i>荷兰猪
                </button>
            </div>

            <footer>
                © 2023 宠物MBTI测试 | 发现您宠物的真实性格
            </footer>
        </div>

        <!-- 照片上传页面 -->
        <div id="page-photo-upload" class="page">
            <header>
                <div class="header-decor"></div>
                <div class="header-content">
                    <h1 id="upload-title">正在测试: <span id="pet-type-name"></span></h1>
                    <h2>请上传一张可爱的宠物照片</h2>
                </div>
            </header>

            <div class="photo-frame">
                <div id="photo-placeholder" class="photo-placeholder">
                    <i class="fas fa-camera"></i>
                    <p>请上传宠物照片</p>
                </div>
                <img id="pet-photo" style="display: none;" alt="宠物照片">
            </div>

            <input type="file" id="photo-upload" accept="image/*" style="display: none;">
            <button class="btn btn-upload" id="btn-upload">
                <i class="fas fa-cloud-upload-alt"></i> 选择照片
            </button>

            <div class="btn-group">
                <button class="btn btn-back" id="btn-back">
                    <i class="fas fa-arrow-left"></i> 返回
                </button>
                <button class="btn btn-next" id="btn-start-test" disabled>
                    <i class="fas fa-play"></i> 开始测试
                </button>
            </div>
        </div>

        <!-- 测试问题页面 -->
        <div id="page-test" class="page">
            <div class="pet-info">
                <span id="pet-info">宠物类型: <span id="current-pet-type"></span></span>
                <span id="progress">进度: <span id="current-question">0</span>/<span id="total-questions">0</span></span>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" id="progress-bar"></div>
                </div>
                <div class="progress-text">
                    <span>开始测试</span>
                    <span>完成测试</span>
                </div>
            </div>

            <div class="question-box">
                <div class="question-text" id="question-text">
                    <i class="fas fa-question-circle"></i>
                    <span id="question-content"></span>
                </div>
                <div class="options-group" id="options-container"></div>
            </div>

            <div class="btn-group">
                <button class="btn btn-back" id="btn-prev">
                    <i class="fas fa-arrow-left"></i> 上一题
                </button>
                <button class="btn btn-next" id="btn-next">
                    下一题 <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- 结果页面 -->
        <div id="page-result" class="page">
            <div class="result-container">
                <div class="result-header">
                    <div class="decoration decoration-1">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="decoration decoration-2">
                        <i class="fas fa-star"></i>
                    </div>

                    <div class="pet-photo-container">
                        <img id="result-photo" alt="宠物照片">
                    </div>

                    <h1 class="result-title">宠物性格分析报告</h1>
                    <div class="result-subtitle" id="result-subtitle">您的<span id="report-pet-type"></span>性格类型是</div>

                    <div class="mbti-badge" id="mbti-type">
                        <span id="mbti-result"></span>
                    </div>
                    <div class="mbti-name" id="mbti-name">类型名称: <span id="mbti-name-text"></span></div>
                </div>

                <div class="result-content">
                    <div class="section">
                        <h3 class="section-title"><i class="fas fa-star"></i> 性格特点</h3>
                        <div class="traits-list" id="traits-list"></div>
                    </div>

                    <div class="section">
                        <h3 class="section-title"><i class="fas fa-file-alt"></i> 性格分析</h3>
                        <div class="analysis-content" id="analysis-content"></div>
                    </div>

                    <div class="section">
                        <h3 class="section-title"><i class="fas fa-hand-holding-heart"></i> 互动建议</h3>
                        <div class="analysis-content" id="interaction-content"></div>
                    </div>

                    <div class="section">
                        <h3 class="section-title"><i class="fas fa-lightbulb"></i> 饲养贴士</h3>
                        <div class="suggestions-list" id="suggestions-list"></div>
                    </div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-restart" id="btn-restart">
                    <i class="fas fa-redo"></i> 重新测试
                </button>
                <button class="btn btn-save" id="btn-save">
                    <i class="fas fa-download"></i> 保存报告
                </button>
            </div>

            <footer>
                © 2023 宠物MBTI测试 | 报告生成时间: <span id="report-date"></span>
            </footer>
        </div>
    </div>

    <!-- 报告下载通知 -->
    <div class="report-notification" id="report-notification">
        <i class="fas fa-check-circle"></i>报告已生成并开始下载！
    </div>

    <script>
        // 宠物类型和MBTI描述数据
        const PET_TYPES = ["金丝熊", "侏儒类", "喵喵", "狗狗", "龙猫", "荷兰猪"];

        const MBTI_DESC = {
            "ISTJ": {
                "name": "守序者",
                "traits": ["严谨可靠", "喜欢规律作息", "注重细节", "有责任感", "做事有条理"],
                "description": "您的宠物是可靠的守护者，注重规律和秩序。它们喜欢可预测的环境和明确的规则，对熟悉的人和事物表现出极大的忠诚。",
                "interaction": "为TA建立固定的作息时间表，提供整洁有序的生活空间。避免突然改变环境，给予明确的指令和奖励。",
                "icons": ["fa-check-double", "fa-clock", "fa-search", "fa-shield-alt", "fa-list"]
            },
            "ISTP": {
                "name": "巧匠",
                "traits": ["动手能力强", "独立自主", "善于解决问题", "好奇心重", "喜欢探索"],
                "description": "您的宠物是灵活的实践者，善于解决实际问题。它们喜欢探索环境，通过直接体验来理解世界，对变化有很强的适应能力。",
                "interaction": "提供丰富的益智玩具和探索机会，允许TA独立解决问题。避免过度干涉TA的活动，给予足够的自由空间。",
                "icons": ["fa-tools", "fa-user-alt", "fa-puzzle-piece", "fa-question-circle", "fa-binoculars"]
            },
            "ISFJ": {
                "name": "守护者",
                "traits": ["忠诚体贴", "有责任感", "重视传统", "细心周到", "善于照顾"],
                "description": "您的宠物是贴心的照顾者，非常关注主人的需求和情绪。它们会建立强烈的归属感，对熟悉的环境表现出极大的依恋。",
                "interaction": "建立稳定的情感连接，定期进行亲密互动。保持环境的一致性，避免频繁改变TA的生活空间。",
                "icons": ["fa-heart", "fa-medal", "fa-history", "fa-sticky-note", "fa-hands-helping"]
            },
            "ISFP": {
                "name": "艺术家",
                "traits": ["温和友善", "审美敏锐", "享受当下", "富有同情心", "追求和谐"],
                "description": "您的宠物是温和的艺术家，对美感和舒适有特别的追求。它们喜欢和谐的环境，通过温和的方式表达情感，对冲突非常敏感。",
                "icons": ["fa-dove", "fa-palette", "fa-sun", "fa-hand-holding-heart", "fa-balance-scale"]
            },
            "INFJ": {
                "name": "倡导者",
                "traits": ["富有洞察力", "理想主义", "有使命感", "善解人意", "富有创造力"],
                "description": "您的宠物是理想主义的倡导者，对环境和情绪变化非常敏感。它们有强烈的直觉能力，能感知主人的情绪状态并做出反应。",
                "icons": ["fa-eye", "fa-seedling", "fa-flag", "fa-smile", "fa-lightbulb"]
            },
            "INFP": {
                "name": "治愈者",
                "traits": ["充满热情", "富有创造力", "价值观明确", "善解人意", "富有想象力"],
                "description": "您的宠物是充满创造力的治愈者，有着丰富的内心世界。它们通过独特的方式表达情感，对不公正的环境非常敏感。",
                "icons": ["fa-fire", "fa-paint-brush", "fa-gem", "fa-hand-holding-medical", "fa-cloud"]
            },
            "INTJ": {
                "name": "战略家",
                "traits": ["思维严谨", "独立自主", "善于规划", "目标明确", "理性分析"],
                "description": "您的宠物是独立的思想家，善于制定长期计划。它们对环境有很强的控制欲，喜欢按照自己的方式安排生活空间。",
                "icons": ["fa-brain", "fa-user-astronaut", "fa-project-diagram", "fa-bullseye", "fa-calculator"]
            },
            "INTP": {
                "name": "学者",
                "traits": ["逻辑性强", "好奇心重", "善于分析", "独立思考", "追求知识"],
                "description": "您的宠物是好奇的探索者，对事物的工作原理充满兴趣。它们会花大量时间观察环境，通过实验了解世界的运作方式。",
                "icons": ["fa-atom", "fa-question", "fa-chart-line", "fa-user-graduate", "fa-book-open"]
            },
            "ESTP": {
                "name": "冒险家",
                "traits": ["精力充沛", "灵活应变", "活在当下", "勇敢果断", "喜欢挑战"],
                "description": "您的宠物是精力充沛的冒险家，喜欢即兴活动和刺激体验。它们对环境变化反应迅速，总是寻找新的探索机会。",
                "icons": ["fa-bolt", "fa-sync", "fa-calendar-day", "fa-fist-raised", "fa-mountain"]
            },
            "ESTJ": {
                "name": "管理者",
                "traits": ["高效务实", "组织能力强", "重视秩序", "有责任感", "领导能力强"],
                "description": "您的宠物是高效的组织者，喜欢建立明确的日常规律。它们对环境的秩序有强烈需求，会主动维护生活空间的整洁。",
                "icons": ["fa-rocket", "fa-sitemap", "fa-sort-amount-up", "fa-award", "fa-users"]
            },
            "ESFP": {
                "name": "表演者",
                "traits": ["活泼开朗", "善于交际", "享受生活", "富有魅力", "即兴发挥"],
                "description": "您的宠物是活泼的表演者，喜欢成为关注的焦点。它们通过肢体语言和声音表达情感，善于与主人建立情感连接。",
                "icons": ["fa-laugh-beam", "fa-comments", "fa-glass-cheers", "fa-magic", "fa-music"]
            },
            "ESFJ": {
                "name": "组织者",
                "traits": ["乐于助人", "社交能力强", "注重和谐", "体贴周到", "善于合作"],
                "description": "您的宠物是社交的协调者，对群体互动有强烈需求。它们会主动参与家庭活动，对家庭成员的情绪变化非常敏感。",
                "icons": ["fa-hands-helping", "fa-user-friends", "fa-peace", "fa-stethoscope", "fa-people-arrows"]
            },
            "ENFP": {
                "name": "激发者",
                "traits": ["热情洋溢", "富有想象力", "善于沟通", "充满创意", "乐观积极"],
                "description": "您的宠物是热情的激发者，充满好奇心和想象力。它们喜欢探索新环境，通过积极互动建立与主人的深厚情感。",
                "icons": ["fa-sun", "fa-rainbow", "fa-comment-dots", "fa-feather", "fa-grin-stars"]
            },
            "ENFJ": {
                "name": "教育家",
                "traits": ["善于领导", "富有同理心", "鼓舞他人", "关心他人", "善于沟通"],
                "description": "您的宠物是充满魅力的领导者，善于协调群体关系。它们会主动照顾其他宠物，在家庭中扮演保护者的角色。",
                "icons": ["fa-crown", "fa-hand-holding-heart", "fa-bullhorn", "fa-heartbeat", "fa-comments"]
            },
            "ENTP": {
                "name": "辩论家",
                "traits": ["思维敏捷", "创意无限", "喜欢挑战", "善于分析", "充满活力"],
                "description": "您的宠物是充满创意的探索者，对新奇事物充满好奇。它们喜欢智力挑战，善于发现环境中的新可能性。",
                "icons": ["fa-brain", "fa-lightbulb", "fa-gamepad", "fa-chart-pie", "fa-battery-full"]
            },
            "ENTJ": {
                "name": "指挥官",
                "traits": ["果断坚决", "战略思维", "善于组织", "领导力强", "目标导向"],
                "description": "您的宠物是天生的领导者，喜欢组织和控制环境。它们表现出强烈的自信，在熟悉的环境中会主动建立规则和秩序。",
                "icons": ["fa-gavel", "fa-chess", "fa-layer-group", "fa-user-tie", "fa-bullseye"]
            }
        };

        // 测试题库
        const QUESTIONS = {
            "金丝熊": [
                {"text": "在新环境中，TA的表现是？", "options": ["立即探索所有角落", "先观察再行动", "紧张躲藏"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "对玩具的偏好是？", "options": ["跑轮等运动类", "啃咬类", "藏身类"], "dimension": "SN", "weights": [1, 0.5, -1]},
                {"text": "被主人抚摸时的反应？", "options": ["主动亲近", "无所谓", "躲避抗拒"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "进食习惯如何？", "options": ["定时定量", "少量多次", "随时进食"], "dimension": "JP", "weights": [1, 0, -1]},
                {"text": "与其他金丝熊相处时？", "options": ["主动社交", "选择性互动", "回避接触"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "对新鲜食物的态度？", "options": ["立即尝试", "谨慎观察", "完全拒绝"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "被抱起时的反应？", "options": ["安静享受", "轻微挣扎", "激烈反抗"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "日常活动模式？", "options": ["夜间活跃", "白天活跃", "全天间歇活动"], "dimension": "JP", "weights": [1, 0.5, -0.5]},
                {"text": "面对陌生物体时？", "options": ["立即接触", "保持距离观察", "躲藏"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "清洁习惯如何？", "options": ["固定时间沙浴", "随时沙浴", "很少沙浴"], "dimension": "JP", "weights": [1, 0.5, -1]}
            ],
            "侏儒类": [
                {"text": "在新环境中，TA的表现是？", "options": ["立即探索所有角落", "先观察再行动", "紧张躲藏"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "对玩具的偏好是？", "options": ["跑轮等运动类", "啃咬类", "藏身类"], "dimension": "SN", "weights": [1, 0.5, -1]},
                {"text": "被主人抚摸时的反应？", "options": ["主动亲近", "无所谓", "躲避抗拒"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "进食习惯如何？", "options": ["定时定量", "少量多次", "随时进食"], "dimension": "JP", "weights": [1, 0, -1]},
                {"text": "与其他侏儒类仓鼠相处时？", "options": ["主动社交", "选择性互动", "回避接触"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "对新鲜食物的态度？", "options": ["立即尝试", "谨慎观察", "完全拒绝"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "被抱起时的反应？", "options": ["安静享受", "轻微挣扎", "激烈反抗"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "日常活动模式？", "options": ["夜间活跃", "白天活跃", "全天间歇活动"], "dimension": "JP", "weights": [1, 0.5, -0.5]},
                {"text": "面对陌生物体时？", "options": ["立即接触", "保持距离观察", "躲藏"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "清洁习惯如何？", "options": ["固定时间沙浴", "随时沙浴", "很少沙浴"], "dimension": "JP", "weights": [1, 0.5, -1]}
            ],
            "喵喵": [
                {"text": "对陌生人的反应？", "options": ["主动靠近", "观察后接近", "躲藏或攻击"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "玩耍时的专注度？", "options": ["高度专注捕猎", "玩一会儿就失去兴趣", "完全不理睬"], "dimension": "JP", "weights": [1, 0, -1]},
                {"text": "日常作息规律？", "options": ["非常固定", "随心情变化", "日夜颠倒"], "dimension": "JP", "weights": [1, 0, -1]},
                {"text": "被抱起时的反应？", "options": ["呼噜享受", "适度挣扎", "强烈反抗"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "对高处位置的态度？", "options": ["经常攀爬", "偶尔上去", "从不尝试"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "面对其他喵喵时？", "options": ["主动社交", "保持距离", "攻击性反应"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "对新玩具的反应？", "options": ["立即探索", "观察后接触", "完全忽视"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "梳理毛发频率？", "options": ["非常频繁", "适度梳理", "很少梳理"], "dimension": "JP", "weights": [1, 0.5, -1]},
                {"text": "被限制行动时？", "options": ["安静接受", "适度挣扎", "激烈反抗"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "环境变化时的反应？", "options": ["快速适应", "缓慢适应", "持续焦虑"], "dimension": "JP", "weights": [1, 0, -1]}
            ],
            "狗狗": [
                {"text": "散步时的行为？", "options": ["兴奋探索新路线", "固定路线最安心", "只想回家"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "与其他狗狗相处？", "options": ["主动社交", "选择性社交", "回避或冲突"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "训练学习速度？", "options": ["很快掌握新指令", "需要多次重复", "完全不理指令"], "dimension": "JP", "weights": [1, 0, -1]},
                {"text": "主人回家时的反应？", "options": ["极度兴奋迎接", "适度欢迎", "冷淡反应"], "dimension": "TF", "weights": [1, 0.5, -1]},
                {"text": "对新环境的适应？", "options": ["立即探索", "谨慎观察", "焦虑不安"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "玩具偏好类型？", "options": ["互动类玩具", "啃咬类玩具", "毛绒玩具"], "dimension": "SN", "weights": [1, 0.5, -0.5]},
                {"text": "独处时的行为？", "options": ["安静休息", "适度焦虑", "破坏性行为"], "dimension": "JP", "weights": [1, 0, -1]},
                {"text": "被训斥时的反应？", "options": ["明显沮丧", "适度反应", "完全不在乎"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "面对陌生人的态度？", "options": ["立即亲近", "观察后接近", "警惕吠叫"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "日常作息规律？", "options": ["严格遵循", "基本遵守", "毫无规律"], "dimension": "JP", "weights": [1, 0.5, -1]}
            ],
            "龙猫": [
                {"text": "日常活动模式？", "options": ["夜间活跃", "白天活跃", "全天间歇活动"], "dimension": "EI", "weights": [1, -1, 0]},
                {"text": "对新食物的态度？", "options": ["立即尝试", "谨慎观察", "完全拒绝"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "清洁习惯？", "options": ["固定时间沙浴", "随时沙浴", "很少沙浴"], "dimension": "JP", "weights": [1, 0.5, -1]},
                {"text": "被抱起时的反应？", "options": ["安静不动", "适度挣扎", "强烈挣扎"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "对新玩具的反应？", "options": ["立即探索", "缓慢接近", "完全忽视"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "环境温度变化时？", "options": ["适应良好", "适度不适", "明显焦虑"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "社交需求程度？", "options": ["需要同伴", "可有可无", "喜欢独处"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "进食行为？", "options": ["定时定量", "少量多次", "随时进食"], "dimension": "JP", "weights": [1, 0.5, -1]},
                {"text": "面对陌生声音时？", "options": ["好奇探查", "保持警惕", "躲藏"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "梳理毛发频率？", "options": ["非常频繁", "适度梳理", "很少梳理"], "dimension": "JP", "weights": [1, 0.5, -1]}
            ],
            "荷兰猪": [
                {"text": "社交需求程度？", "options": ["必须同伴陪伴", "可有可无", "喜欢独处"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "进食行为？", "options": ["定时定量", "少量多次", "随时进食"], "dimension": "JP", "weights": [1, 0.5, -1]},
                {"text": "被抱起时的反应？", "options": ["安静享受", "轻微挣扎", "激烈反抗"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "对新环境的适应？", "options": ["快速适应", "缓慢适应", "持续紧张"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "对新鲜蔬菜的态度？", "options": ["立即尝试", "谨慎观察", "完全拒绝"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "日常活动模式？", "options": ["白天活跃", "夜间活跃", "全天均衡"], "dimension": "JP", "weights": [1, -1, 0]},
                {"text": "被抚摸时的反应？", "options": ["发出满足声", "安静接受", "躲避接触"], "dimension": "TF", "weights": [1, 0, -1]},
                {"text": "面对陌生物体时？", "options": ["立即探查", "保持距离", "躲藏"], "dimension": "SN", "weights": [1, 0, -1]},
                {"text": "与主人互动时？", "options": ["主动接近", "被动接受", "回避互动"], "dimension": "EI", "weights": [1, 0, -1]},
                {"text": "清洁习惯如何？", "options": ["自我清洁频繁", "适度清洁", "很少清洁"], "dimension": "JP", "weights": [1, 0.5, -1]}
            ]
        };

        // 应用状态
        const appState = {
            petType: "",
            photoData: "",
            answers: {},
            currentQuestion: 0
        };

        // DOM元素
        const pages = {
            petSelection: document.getElementById('page-pet-selection'),
            photoUpload: document.getElementById('page-photo-upload'),
            test: document.getElementById('page-test'),
            result: document.getElementById('page-result')
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            // 宠物选择
            document.querySelectorAll('.btn-pet').forEach(btn => {
                btn.addEventListener('click', () => {
                    appState.petType = btn.dataset.pet;
                    document.getElementById('pet-type-name').textContent = appState.petType;
                    document.getElementById('current-pet-type').textContent = appState.petType;
                    showPage('photoUpload');
                });
            });

            // 照片上传
            document.getElementById('btn-upload').addEventListener('click', () => {
                document.getElementById('photo-upload').click();
            });

            document.getElementById('photo-upload').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        appState.photoData = event.target.result;
                        document.getElementById('pet-photo').src = appState.photoData;
                        document.getElementById('pet-photo').style.display = 'block';
                        document.getElementById('photo-placeholder').style.display = 'none';
                        document.getElementById('btn-start-test').disabled = false;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // 开始测试
            document.getElementById('btn-start-test').addEventListener('click', () => {
                startTest();
            });

            // 返回按钮
            document.getElementById('btn-back').addEventListener('click', () => {
                showPage('petSelection');
            });

            // 上一题
            document.getElementById('btn-prev').addEventListener('click', () => {
                if (appState.currentQuestion > 0) {
                    appState.currentQuestion--;
                    showQuestion();
                }
            });

            // 下一题
            document.getElementById('btn-next').addEventListener('click', () => {
                if (appState.currentQuestion in appState.answers) {
                    if (appState.currentQuestion < QUESTIONS[appState.petType].length - 1) {
                        appState.currentQuestion++;
                        showQuestion();
                    } else {
                        generateReport();
                    }
                } else {
                    alert('请先选择一个选项');
                }
            });

            // 重新测试
            document.getElementById('btn-restart').addEventListener('click', () => {
                showPage('petSelection');
                resetAppState();
            });

            // 保存报告
            document.getElementById('btn-save').addEventListener('click', () => {
                saveReport();
            });
        });

        // 显示页面
        function showPage(pageName) {
            Object.values(pages).forEach(page => page.classList.remove('active'));
            pages[pageName].classList.add('active');
        }

        // 开始测试
        function startTest() {
            appState.answers = {};
            appState.currentQuestion = 0;
            showPage('test');
            showQuestion();
        }

        // 重置应用状态
        function resetAppState() {
            appState.petType = "";
            appState.photoData = "";
            appState.answers = {};
            appState.currentQuestion = 0;
            document.getElementById('pet-photo').style.display = 'none';
            document.getElementById('photo-placeholder').style.display = 'block';
            document.getElementById('btn-start-test').disabled = true;
        }

        // 显示问题
        function showQuestion() {
            const questions = QUESTIONS[appState.petType];
            const question = questions[appState.currentQuestion];

            // 更新进度信息
            document.getElementById('current-question').textContent = appState.currentQuestion + 1;
            document.getElementById('total-questions').textContent = questions.length;
            document.getElementById('progress-bar').style.width = `${(appState.currentQuestion + 1) / questions.length * 100}%`;
            document.getElementById('question-content').textContent = question.text;

            // 创建选项
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            const optionIcons = ["fa-paw", "fa-heart", "fa-star", "fa-comment"];

            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                if (appState.answers[appState.currentQuestion] === index) {
                    optionElement.classList.add('selected');
                }

                optionElement.innerHTML = `
                    <i class="fas ${optionIcons[index]}"></i>
                    <span>${option}</span>
                `;

                optionElement.addEventListener('click', () => {
                    // 移除之前的选择
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    // 设置当前选择
                    optionElement.classList.add('selected');
                    appState.answers[appState.currentQuestion] = index;
                });

                optionsContainer.appendChild(optionElement);
            });

            // 更新按钮状态
            document.getElementById('btn-prev').disabled = appState.currentQuestion === 0;
            document.getElementById('btn-next').textContent =
                appState.currentQuestion < questions.length - 1 ? '下一题' : '完成测试';
        }

        // 计算MBTI类型
        function calculateMBTI() {
            const dimensionScores = {
                'E': 0, 'I': 0,
                'S': 0, 'N': 0,
                'T': 0, 'F': 0,
                'J': 0, 'P': 0
            };

            const questions = QUESTIONS[appState.petType];
            for (const [qIndex, answerIndex] of Object.entries(appState.answers)) {
                const question = questions[parseInt(qIndex)];
                const weight = question.weights[answerIndex];
                const dimension = question.dimension;

                // 根据问题的维度分配分数
                switch (dimension) {
                    case "EI":
                        dimensionScores['E'] += weight;
                        dimensionScores['I'] -= weight;
                        break;
                    case "SN":
                        dimensionScores['S'] += weight;
                        dimensionScores['N'] -= weight;
                        break;
                    case "TF":
                        dimensionScores['T'] += weight;
                        dimensionScores['F'] -= weight;
                        break;
                    case "JP":
                        dimensionScores['J'] += weight;
                        dimensionScores['P'] -= weight;
                        break;
                }
            }

            // 确定MBTI类型
            let mbtiType = "";
            mbtiType += dimensionScores['E'] >= dimensionScores['I'] ? 'E' : 'I';
            mbtiType += dimensionScores['S'] >= dimensionScores['N'] ? 'S' : 'N';
            mbtiType += dimensionScores['T'] >= dimensionScores['F'] ? 'T' : 'F';
            mbtiType += dimensionScores['J'] >= dimensionScores['P'] ? 'J' : 'P';

            return mbtiType;
        }

        // 生成报告
        function generateReport() {
            const mbtiType = calculateMBTI();
            const desc = MBTI_DESC[mbtiType] || MBTI_DESC.ISTJ; // 防止未定义

            // 设置结果页面内容
            document.getElementById('result-photo').src = appState.photoData;
            document.getElementById('mbti-result').textContent = mbtiType;
            document.getElementById('mbti-name-text').textContent = desc.name;
            document.getElementById('report-pet-type').textContent = appState.petType;
            document.getElementById('result-subtitle').textContent = `您的${appState.petType}性格类型是`;

            // 设置日期
            const now = new Date();
            document.getElementById('report-date').textContent = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();

            // 设置性格特点
            const traitsList = document.getElementById('traits-list');
            traitsList.innerHTML = '';

            desc.traits.forEach((trait, index) => {
                const traitCard = document.createElement('div');
                traitCard.className = 'trait-card';

                let icon = desc.icons && index < desc.icons.length ? desc.icons[index] : 'fa-paw';

                traitCard.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <div class="trait-text">${trait}</div>
                `;
                traitsList.appendChild(traitCard);
            });

            // 设置详细分析
            const analysisContent = document.getElementById('analysis-content');
            analysisContent.innerHTML = `
                <p>${getAnalysisText(mbtiType, appState.petType)}</p>
                <p>${getPersonalityDesc(mbtiType)}</p>
            `;

            // 设置互动建议
            document.getElementById('interaction-content').innerHTML = `
                <p>${desc.interaction}</p>
                <div class="suggestions-list">
                    ${getInteractionTips(mbtiType).map(tip => `
                        <div class="suggestion">
                            <i class="fas fa-check-circle"></i>
                            <div>${tip}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            // 设置饲养建议
            const suggestionsList = document.getElementById('suggestions-list');
            suggestionsList.innerHTML = '';

            getSuggestions(appState.petType, mbtiType).forEach(suggestion => {
                const suggestionEl = document.createElement('div');
                suggestionEl.className = 'suggestion';
                suggestionEl.innerHTML = `
                    <i class="fas fa-lightbulb"></i>
                    <div>${suggestion}</div>
                `;
                suggestionsList.appendChild(suggestionEl);
            });

            // 显示结果页面
            showPage('result');
        }

        // 获取详细分析文本
        function getAnalysisText(mbtiType, petType) {
            const analysisMap = {
                "ISTJ": `您的${petType}是可靠的守护者，注重规律和秩序。它们喜欢可预测的环境和明确的规则，对熟悉的人和事物表现出极大的忠诚。`,
                "ISTP": `您的${petType}是灵活的实践者，善于解决实际问题。它们喜欢探索环境，通过直接体验来理解世界，对变化有很强的适应能力。`,
                "ISFJ": `您的${petType}是贴心的照顾者，非常关注主人的需求和情绪。它们会建立强烈的归属感，对熟悉的环境表现出极大的依恋。`,
                "ISFP": `您的${petType}是温和的艺术家，对美感和舒适有特别的追求。它们喜欢和谐的环境，通过温和的方式表达情感，对冲突非常敏感。`,
                "INFJ": `您的${petType}是理想主义的倡导者，对环境和情绪变化非常敏感。它们有强烈的直觉能力，能感知主人的情绪状态并做出反应。`,
                "INFP": `您的${petType}是充满创造力的治愈者，有着丰富的内心世界。它们通过独特的方式表达情感，对不公正的环境非常敏感。`,
                "INTJ": `您的${petType}是独立的思想家，善于制定长期计划。它们对环境有很强的控制欲，喜欢按照自己的方式安排生活空间。`,
                "INTP": `您的${petType}是好奇的探索者，对事物的工作原理充满兴趣。它们会花大量时间观察环境，通过实验了解世界的运作方式。`,
                "ESTP": `您的${petType}是精力充沛的冒险家，喜欢即兴活动和刺激体验。它们对环境变化反应迅速，总是寻找新的探索机会。`,
                "ESTJ": `您的${petType}是高效的组织者，喜欢建立明确的日常规律。它们对环境的秩序有强烈需求，会主动维护生活空间的整洁。`,
                "ESFP": `您的${petType}是活泼的表演者，喜欢成为关注的焦点。它们通过肢体语言和声音表达情感，善于与主人建立情感连接。`,
                "ESFJ": `您的${petType}是社交的协调者，对群体互动有强烈需求。它们会主动参与家庭活动，对家庭成员的情绪变化非常敏感。`,
                "ENFP": `您的${petType}是热情的激发者，充满好奇心和想象力。它们喜欢探索新环境，通过积极互动建立与主人的深厚情感。`,
                "ENFJ": `您的${petType}是充满魅力的领导者，善于协调群体关系。它们会主动照顾其他宠物，在家庭中扮演保护者的角色。`,
                "ENTP": `您的${petType}是充满创意的探索者，对新奇事物充满好奇。它们喜欢智力挑战，善于发现环境中的新可能性。`,
                "ENTJ": `您的${petType}是天生的领导者，喜欢组织和控制环境。它们表现出强烈的自信，在熟悉的环境中会主动建立规则和秩序。`
            };

            return analysisMap[mbtiType] || `您的${petType}表现出独特的性格特征，需要主人用心观察和理解。这种性格的宠物通常有自己的特殊需求和偏好，主人需要花时间了解TA的个性特点，才能建立更深厚的感情连接。`;
        }

        // 获取性格描述
        function getPersonalityDesc(mbtiType) {
            const descMap = {
                "ISTJ": `这类宠物通常有固定的作息习惯，喜欢可预测的环境。它们会对熟悉的主人表现出极大的忠诚，但可能需要时间适应新环境。`,
                "ISTP": `好奇心驱使它们探索周围的一切，喜欢解决问题的过程。这类宠物需要丰富的环境刺激，但同时也需要自己的空间。`,
                "ISFJ": `非常关注家庭成员的情绪变化，会主动提供安慰。它们需要稳定的环境和明确的日常安排，变化可能会让它们不安。`,
                "ISFP": `对美感和舒适有特别的追求，喜欢和谐的环境。它们通过温和的方式表达情感，对冲突非常敏感。`,
                "INFJ": `有强烈的直觉能力，能感知主人的情绪状态。这类宠物通常表现出超越普通动物的理解力，需要深层次的情感连接。`,
                "INFP": `有着丰富的内心世界，通过独特的方式表达情感。它们需要安全自由的环境来展现创造力，对不公正的环境非常敏感。`,
                "INTJ": `善于制定长期计划，对环境有很强的控制欲。这类宠物喜欢按照自己的方式安排生活空间，需要智力挑战活动。`,
                "INTP": `对事物的工作原理充满兴趣，喜欢观察和分析。它们需要探索机会和益智玩具来满足好奇心。`,
                "ESTP": `喜欢即兴活动和刺激体验，对环境变化反应迅速。这类宠物需要充足的运动空间和冒险机会。`,
                "ESTJ": `喜欢建立明确的日常规律，对环境的秩序有强烈需求。它们会主动维护生活空间的整洁，需要清晰的生活规则。`,
                "ESFP": `喜欢成为关注的焦点，善于与主人建立情感连接。这类宠物需要社交机会和表演舞台，喜欢热闹的环境。`,
                "ESFJ": `对群体互动有强烈需求，会主动参与家庭活动。它们需要和谐的家庭氛围，对家庭成员的情绪变化非常敏感。`,
                "ENFP": `充满好奇心和想象力，喜欢探索新环境。这类宠物需要新颖的玩具和探索机会，避免单调重复的活动。`,
                "ENFJ": `善于协调群体关系，会主动照顾其他宠物。这类宠物需要社交互动空间，喜欢扮演保护者的角色。`,
                "ENTP": `对新奇事物充满好奇，喜欢智力挑战。这类宠物需要问题解决机会，鼓励创新行为。`,
                "ENTJ": `喜欢组织和控制环境，表现出强烈的自信。这类宠物需要组织性活动，喜欢建立规则和秩序。`
            };

            return descMap[mbtiType] || "每只宠物都有独特的性格特点，需要主人用心观察和理解。了解宠物的性格类型可以帮助您提供更适合的饲养环境和互动方式。";
        }

        // 获取互动建议
        function getInteractionTips(mbtiType) {
            const tipsMap = {
                "ISTJ": [
                    "建立固定的作息时间表",
                    "提供整洁有序的生活空间",
                    "避免突然改变环境",
                    "给予明确的指令和奖励"
                ],
                "ISTP": [
                    "提供丰富的益智玩具",
                    "允许TA独立解决问题",
                    "避免过度干涉TA的活动",
                    "给予足够的自由空间"
                ],
                "ISFJ": [
                    "建立稳定的情感连接",
                    "定期进行亲密互动",
                    "保持环境的一致性",
                    "避免频繁改变生活空间"
                ],
                "ISFP": [
                    "创造温馨舒适的生活环境",
                    "提供艺术性玩具",
                    "尊重TA的个性空间",
                    "用温和的方式互动"
                ],
                "INFJ": [
                    "保持情绪稳定",
                    "提供安静思考空间",
                    "通过温和的眼神交流建立信任",
                    "避免嘈杂混乱的环境"
                ],
                "INFP": [
                    "鼓励TA的创造性行为",
                    "提供表达个性的机会",
                    "尊重TA的情感需求",
                    "创造安全自由的成长空间"
                ],
                "INTJ": [
                    "提供智力挑战游戏",
                    "尊重TA的独立空间",
                    "用逻辑性方式沟通",
                    "避免情绪化互动"
                ],
                "INTP": [
                    "提供丰富的探索机会",
                    "鼓励TA的观察行为",
                    "耐心解答TA的'好奇心'",
                    "提供各种益智玩具"
                ],
                "ESTP": [
                    "提供充足的运动空间",
                    "保持活动多样性",
                    "确保环境安全",
                    "防止过度冒险"
                ],
                "ESTJ": [
                    "建立清晰的生活规则",
                    "给予TA一定的'管理'空间",
                    "认可TA的组织行为",
                    "保持固定的作息时间"
                ],
                "ESFP": [
                    "提供社交机会和表演舞台",
                    "及时回应TA的互动请求",
                    "给予充分关注和赞美",
                    "保持互动趣味性"
                ],
                "ESFJ": [
                    "提供群体互动机会",
                    "让TA参与家庭活动",
                    "认可TA的关怀行为",
                    "建立和谐的家庭氛围"
                ],
                "ENFP": [
                    "提供新颖的玩具和探索机会",
                    "保持互动趣味性",
                    "鼓励TA的创意行为",
                    "避免单调重复的活动"
                ],
                "ENFJ": [
                    "给予TA'领导'机会",
                    "认可TA的关怀行为",
                    "提供社交互动空间",
                    "让TA照顾其他宠物"
                ],
                "ENTP": [
                    "提供智力挑战和问题解决机会",
                    "鼓励TA的创新行为",
                    "保持环境的新鲜感",
                    "避免过度约束"
                ],
                "ENTJ": [
                    "给予TA一定的'管理'空间",
                    "提供组织性活动",
                    "认可TA的领导行为",
                    "避免过度干涉TA的计划"
                ]
            };

            return tipsMap[mbtiType] || [
                "每天保持固定的互动时间",
                "使用TA喜欢的互动方式",
                "避免在TA休息或进食时打扰",
                "对TA的良好行为给予及时奖励"
            ];
        }

        // 获取饲养建议
        function getSuggestions(petType, mbtiType) {
            const suggestions = [];

            // 通用建议
            if (mbtiType.includes('E')) {
                suggestions.push("提供丰富的社交互动和群体活动");
            } else {
                suggestions.push("提供安静舒适的独处空间");
            }

            if (mbtiType.includes('J')) {
                suggestions.push("保持固定的作息时间和活动安排");
            } else {
                suggestions.push("允许灵活的活动安排和变化");
            }

            // 宠物类型专属建议
            if (petType === "狗狗") {
                suggestions.push("每天保证足够的户外活动时间");
                if (mbtiType.includes('S')) {
                    suggestions.push("提供结构化的训练和明确的指令");
                } else {
                    suggestions.push("提供探索新环境的机会");
                }
            } else if (petType === "喵喵") {
                suggestions.push("提供多个休息和观察的高处");
                if (mbtiType.includes('I')) {
                    suggestions.push("设置隐蔽的藏身处供其休息");
                }
            } else if (petType === "金丝熊" || petType === "侏儒类") {
                suggestions.push("提供充足的藏身空间和磨牙玩具");
                if (mbtiType.includes('P')) {
                    suggestions.push("定期更换玩具保持新鲜感");
                }
            } else if (petType === "龙猫") {
                suggestions.push("保持适宜的温度(18-22℃)和湿度环境");
                if (mbtiType.includes('J')) {
                    suggestions.push("固定时间进行沙浴清洁");
                }
            } else if (petType === "荷兰猪") {
                suggestions.push("提供充足的维生素C来源（新鲜蔬菜）");
                if (mbtiType.includes('E')) {
                    suggestions.push("提供同伴共同生活");
                }
            }

            // 额外建议
            suggestions.push("定期进行健康检查，关注TA的行为变化");
            suggestions.push("为TA提供安全、舒适的生活环境");
            suggestions.push("根据季节变化调整饲养方式（如夏季降温）");
            suggestions.push("选择适合TA年龄和体型的饮食");
            suggestions.push("提供丰富多样的玩具和娱乐设施");
            suggestions.push("注意观察TA的饮食偏好和过敏情况");

            return suggestions;
        }

        // 保存报告
        function saveReport() {
            try {
                const mbtiType = document.getElementById('mbti-result').textContent;
                const petType = appState.petType;
                const desc = MBTI_DESC[mbtiType] || MBTI_DESC.ISTJ;

                // 创建报告内容
                const reportContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>${petType}性格分析报告</title>
                        <style>
                            body {
                                font-family: 'Noto Sans SC', sans-serif;
                                padding: 30px;
                                max-width: 800px;
                                margin: 0 auto;
                                background-color: #f9f9f9;
                                color: #333;
                            }
                            .report-header {
                                text-align: center;
                                padding: 30px;
                                background: linear-gradient(120deg, #FF6B8B, #6A5ACD);
                                color: white;
                                border-radius: 20px;
                                margin-bottom: 30px;
                            }
                            h1 {
                                color: white;
                                margin-bottom: 15px;
                            }
                            .pet-photo {
                                width: 180px;
                                height: 180px;
                                border-radius: 50%;
                                overflow: hidden;
                                margin: 0 auto 20px;
                                border: 5px solid rgba(255, 255, 255, 0.5);
                            }
                            .pet-photo img {
                                width: 100%;
                                height: 100%;
                                object-fit: cover;
                            }
                            .mbti-badge {
                                display: inline-block;
                                background: linear-gradient(135deg, #FFD166, #FFB347);
                                color: white;
                                font-size: 2.5rem;
                                font-weight: bold;
                                padding: 15px 40px;
                                border-radius: 50px;
                                margin: 15px 0;
                            }
                            .section {
                                margin-bottom: 30px;
                                padding: 25px;
                                background: white;
                                border-radius: 20px;
                                box-shadow: 0 5px 15px rgba(0,0,0,0.05);
                            }
                            .section-title {
                                font-size: 1.6rem;
                                color: #6A5ACD;
                                margin-bottom: 20px;
                                border-left: 4px solid #FF6B8B;
                                padding-left: 15px;
                            }
                            .traits-list {
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                                gap: 15px;
                            }
                            .trait-card {
                                background: #FFEDF0;
                                border-radius: 15px;
                                padding: 20px;
                                display: flex;
                                align-items: center;
                            }
                            .trait-card i {
                                font-size: 2rem;
                                color: #FF6B8B;
                                margin-right: 15px;
                            }
                            .analysis-content {
                                background: rgba(255, 214, 102, 0.1);
                                border-radius: 15px;
                                padding: 25px;
                                line-height: 1.8;
                                font-size: 1.1rem;
                                margin: 20px 0;
                                border-left: 4px solid #FFD166;
                            }
                            .suggestion {
                                display: flex;
                                align-items: flex-start;
                                margin-bottom: 15px;
                                padding: 15px;
                                background: white;
                                border-radius: 12px;
                                box-shadow: 0 3px 8px rgba(0,0,0,0.05);
                                border-left: 4px solid #06D6A0;
                            }
                            .suggestion i {
                                font-size: 1.5rem;
                                color: #06D6A0;
                                margin-right: 15px;
                            }
                            .footer {
                                text-align: center;
                                color: #6c757d;
                                margin-top: 40px;
                                font-size: 0.9rem;
                                padding-top: 20px;
                                border-top: 1px solid #e9ecef;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="report-header">
                            <div class="pet-photo">
                                <img src="${appState.photoData}" alt="${petType}照片">
                            </div>
                            <h1>${petType}性格分析报告</h1>
                            <div class="mbti-badge">${mbtiType}</div>
                            <div style="font-size: 1.8rem;">${desc.name}</div>
                        </div>

                        <div class="section">
                            <h2 class="section-title">性格特点</h2>
                            <div class="traits-list">
                                ${desc.traits.map((trait, index) => `
                                    <div class="trait-card">
                                        <i class="fas ${desc.icons && index < desc.icons.length ? desc.icons[index] : 'fa-paw'}"></i>
                                        <div class="trait-text">${trait}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="section">
                            <h2 class="section-title">性格分析</h2>
                            <div class="analysis-content">
                                <p>${getAnalysisText(mbtiType, petType)}</p>
                                <p>${getPersonalityDesc(mbtiType)}</p>
                            </div>
                        </div>

                        <div class="section">
                            <h2 class="section-title">互动建议</h2>
                            <div class="analysis-content">
                                <p>${desc.interaction}</p>
                                ${getInteractionTips(mbtiType).map(tip => `
                                    <div class="suggestion">
                                        <i class="fas fa-check-circle"></i>
                                        <div>${tip}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="section">
                            <h2 class="section-title">饲养贴士</h2>
                            ${getSuggestions(petType, mbtiType).map(suggestion => `
                                <div class="suggestion">
                                    <i class="fas fa-lightbulb"></i>
                                    <div>${suggestion}</div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="footer">
                            <p>© 2023 宠物MBTI测试 | 报告生成时间: ${new Date().toLocaleString()}</p>
                        </div>
                    </body>
                    </html>
                `;

                // 创建并下载报告
                const blob = new Blob([reportContent], {type: 'text/html'});
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `${petType}_${mbtiType}_性格分析报告.html`;
                document.body.appendChild(a);
                a.click();

                // 显示下载通知
                const notification = document.getElementById('report-notification');
                notification.style.opacity = 1;
                setTimeout(() => {
                    notification.style.opacity = 0;
                }, 3000);

                // 清理
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            } catch (error) {
                alert(`报告生成失败: ${error.message}`);
                console.error('报告生成错误:', error);
            }
        }
    </script>
</body>
</html>
